<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EUS Data Collection & Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .language-toggle {
            position: absolute;
            top: 30px;
            right: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .language-toggle span {
            font-size: 14px;
            font-weight: 600;
            opacity: 0.7;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .language-toggle span.active {
            opacity: 1;
            font-size: 16px;
        }

        .language-toggle span:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .language-toggle {
                position: static;
                margin-top: 15px;
                justify-content: center;
            }
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            color: #6c757d;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 16px;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .button-group {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .patient-list {
            margin-top: 30px;
        }

        .patient-card {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .patient-info h4 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .patient-info p {
            color: #6c757d;
            font-size: 14px;
        }

        .patient-actions {
            display: flex;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .chart-container h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-toggle">
                <span id="lang-fr" onclick="changeLanguage('fr')">üá´üá∑ FR</span>
                <span>|</span>
                <span id="lang-en" class="active" onclick="changeLanguage('en')">üá¨üáß EN</span>
            </div>
            <h1 id="header-title">üìä EUS Data Collection & Statistics</h1>
            <p id="header-subtitle">Syst√®me de collecte et d'analyse des donn√©es EUS</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('form')">‚ûï Nouveau Patient</button>
            <button class="tab" onclick="switchTab('patients')">üë• Liste des Patients</button>
            <button class="tab" onclick="switchTab('stats')">üìà Statistiques</button>
        </div>

        <!-- TAB 1: FORMULAIRE -->
        <div id="form-tab" class="tab-content active">
            <div class="success-message" id="success-message">
                ‚úÖ Patient enregistr√© avec succ√®s !
            </div>

            <form id="patient-form">
                <!-- IDENTIT√â PATIENT -->
                <div class="form-section">
                    <h3>üÜî Identit√© du Patient</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="fullName">Nom complet</label>
                            <input type="text" name="fullName">
                        </div>
                        <div class="form-group">
                            <label data-i18n="medicalRecordNumber">Num√©ro de dossier m√©dical</label>
                            <input type="text" name="medicalRecordNumber">
                        </div>
                        <div class="form-group">
                            <label data-i18n="age">√Çge</label>
                            <input type="number" name="age" min="0" max="120">
                        </div>
                        <div class="form-group">
                            <label data-i18n="gender">Genre</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="gender" value="Femme" id="gender-f">
                                    <label for="gender-f" data-i18n="female">Femme</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="gender" value="Homme" id="gender-m">
                                    <label for="gender-m" data-i18n="male">Homme</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="residency">R√©sidence</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="residency" value="Rural" id="res-r">
                                    <label for="res-r" data-i18n="rural">Rural</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="residency" value="Urban" id="res-u">
                                    <label for="res-u" data-i18n="urban">Urban</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="dateAdmission">Date d'admission</label>
                            <input type="date" name="dateAdmission">
                        </div>
                        <div class="form-group">
                            <label data-i18n="dateDischarge">Date de sortie</label>
                            <input type="date" name="dateDischarge">
                        </div>
                        <div class="form-group">
                            <label data-i18n="referringDepartment">D√©partement r√©f√©rent</label>
                            <select name="referringDepartment">
                                <option value="" data-i18n="select">S√©lectionner...</option>
                                <option value="Oncology" data-i18n="deptOncology">Oncologie</option>
                                <option value="Pulmonology" data-i18n="deptPulmonology">Pneumologie</option>
                                <option value="Endocrinology" data-i18n="deptEndocrinology">Endocrinologie</option>
                                <option value="Gastroenterology" data-i18n="deptGastroenterology">Gastroent√©rologie</option>
                                <option value="Other" data-i18n="deptOther">Autre</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- INDICATION PRINCIPALE -->
                <div class="form-section">
                    <h3>üéØ Indication Principale pour EUS</h3>
                    <div class="form-grid">
                        <div class="checkbox-group">
                            <input type="checkbox" name="indication_mediastinalMass" id="ind1">
                            <label for="ind1" data-i18n="mediastinalMass">Masse m√©diastinale</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" name="indication_lymphadenopathy" id="ind2">
                            <label for="ind2" data-i18n="lymphadenopathy">Lymphad√©nopathie</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" name="indication_thyroidNodule" id="ind3">
                            <label for="ind3" data-i18n="thyroidNodule">Nodule thyro√Ødien</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" name="indication_adrenalLesion" id="ind4">
                            <label for="ind4" data-i18n="adrenalLesion">L√©sion surr√©nalienne</label>
                        </div>
                        <div class="form-group">
                            <label data-i18n="otherSpecify">Autre (pr√©ciser)</label>
                            <input type="text" name="indication_other">
                        </div>
                    </div>
                </div>

                <!-- ANT√âC√âDENTS M√âDICAUX -->
                <div class="form-section">
                    <h3>üìã Ant√©c√©dents M√©dicaux</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="historyMalignancy">Ant√©c√©dents de malignit√©</label>
                            <textarea name="historyMalignancy"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="thyroidDisorders">Troubles thyro√Ødiens</label>
                            <textarea name="thyroidDisorders"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="cardiopulmonary">Maladies cardiopulmonaires</label>
                            <textarea name="cardiopulmonary"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="historyInfections">Ant√©c√©dents d'infections</label>
                            <textarea name="historyInfections"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="otherComorbidities">Autres comorbidit√©s</label>
                            <textarea name="otherComorbidities"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="surgicalHistory">Ant√©c√©dents chirurgicaux</label>
                            <textarea name="surgicalHistory"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="addictiveSubstances">Substances addictives</label>
                            <textarea name="addictiveSubstances"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="allergies">Allergies</label>
                            <textarea name="allergies"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="familyMalignancy">Ant√©c√©dents familiaux de malignit√©</label>
                            <textarea name="familyMalignancy"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="hereditaryAffections">Affections h√©r√©ditaires</label>
                            <textarea name="hereditaryAffections"></textarea>
                        </div>
                    </div>
                </div>

                <!-- SIGNES G√âN√âRAUX -->
                <div class="form-section">
                    <h3>üå°Ô∏è Signes G√©n√©raux</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="fever">Fi√®vre</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="fever" value="Oui" id="fever-y">
                                    <label for="fever-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="fever" value="Non" id="fever-n">
                                    <label for="fever-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="temperature">Temp√©rature (¬∞C)</label>
                            <input type="number" name="temperature" step="0.1">
                        </div>
                        <div class="form-group">
                            <label data-i18n="weightLoss">Perte de poids involontaire</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="weightLoss" value="Oui" id="wl-y">
                                    <label for="wl-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="weightLoss" value="Non" id="wl-n">
                                    <label for="wl-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="weightLossAmount">Kg/temps</label>
                            <input type="text" name="weightLossAmount">
                        </div>
                        <div class="form-group">
                            <label data-i18n="asthenia">Asth√©nie</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="asthenia" value="Oui" id="ast-y">
                                    <label for="ast-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="asthenia" value="Non" id="ast-n">
                                    <label for="ast-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="anorexia">Anorexie</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="anorexia" value="Oui" id="ano-y">
                                    <label for="ano-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="anorexia" value="Non" id="ano-n">
                                    <label for="ano-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="nightSweats">Sueurs nocturnes</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="nightSweats" value="Oui" id="ns-y">
                                    <label for="ns-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="nightSweats" value="Non" id="ns-n">
                                    <label for="ns-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="pallor">P√¢leur</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="pallor" value="Oui" id="pal-y">
                                    <label for="pal-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="pallor" value="Non" id="pal-n">
                                    <label for="pal-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="edema">≈íd√®me</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="edema" value="Oui" id="ed-y">
                                    <label for="ed-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="edema" value="Non" id="ed-n">
                                    <label for="ed-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="edemaCharacter">Caract√®re de l'≈ìd√®me</label>
                            <input type="text" name="edemaCharacter">
                        </div>
                        <div class="form-group">
                            <label data-i18n="jaundice">Ict√®re</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="jaundice" value="Oui" id="jau-y">
                                    <label for="jau-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="jaundice" value="Non" id="jau-n">
                                    <label for="jau-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="alteredCondition">√âtat g√©n√©ral alt√©r√©</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="alteredCondition" value="Oui" id="alt-y">
                                    <label for="alt-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="alteredCondition" value="Non" id="alt-n">
                                    <label for="alt-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SIGNES FONCTIONNELS -->
                <div class="form-section">
                    <h3>üîç Signes Fonctionnels</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="goitre">Goitre/nodule</label>
                            <input type="text" name="goitre">
                        </div>
                        <div class="form-group">
                            <label data-i18n="dysphonia">Dysphonie</label>
                            <input type="text" name="dysphonia">
                        </div>
                        <div class="form-group">
                            <label data-i18n="dysphagia">Dysphagie</label>
                            <input type="text" name="dysphagia">
                        </div>
                        <div class="form-group">
                            <label data-i18n="neckPain">Douleur cervicale</label>
                            <input type="text" name="neckPain">
                        </div>
                        <div class="form-group">
                            <label data-i18n="compression">Sensation de compression</label>
                            <input type="text" name="compression">
                        </div>
                        <div class="form-group">
                            <label data-i18n="chronicCough">Toux chronique</label>
                            <input type="text" name="chronicCough">
                        </div>
                        <div class="form-group">
                            <label data-i18n="hemoptysis">H√©moptysie</label>
                            <input type="text" name="hemoptysis">
                        </div>
                        <div class="form-group">
                            <label data-i18n="dyspnea">Dyspn√©e</label>
                            <input type="text" name="dyspnea">
                        </div>
                        <div class="form-group">
                            <label data-i18n="chestPain">Douleur thoracique</label>
                            <input type="text" name="chestPain">
                        </div>
                        <div class="form-group">
                            <label data-i18n="hoarseness">Enrouement</label>
                            <input type="text" name="hoarseness">
                        </div>
                    </div>
                </div>

                <!-- INVESTIGATIONS AVANT EUS -->
                <div class="form-section">
                    <h3>üî¨ Investigations Avant EUS</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="biology">Biologie</label>
                            <textarea name="biology"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="tumorMarkers">Marqueurs tumoraux</label>
                            <textarea name="tumorMarkers"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="radiography">Radiographie</label>
                            <textarea name="radiography"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="ultrasound">√âchographie</label>
                            <textarea name="ultrasound"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="ctScan">CT-Scan</label>
                            <textarea name="ctScan"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="mri">IRM</label>
                            <textarea name="mri"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="petScan">PET-Scan</label>
                            <textarea name="petScan"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="ebus">EBUS</label>
                            <textarea name="ebus"></textarea>
                        </div>
                    </div>
                </div>

                <!-- R√âSULTATS EUS -->
                <div class="form-section">
                    <h3>üìç R√©sultats EUS</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="lesionLocation">Localisation de la l√©sion</label>
                            <input type="text" name="lesionLocation">
                        </div>
                        <div class="form-group">
                            <label data-i18n="lesionSize">Taille (mm)</label>
                            <input type="number" name="lesionSize" step="0.1">
                        </div>
                        <div class="form-group">
                            <label data-i18n="echogenicPattern">Pattern √©chog√©nique</label>
                            <select name="echogenicPattern">
                                <option value="" data-i18n="select">S√©lectionner...</option>
                                <option value="Hypo√©cho√Øque" data-i18n="echogenicHypo">Hypo√©cho√Øque</option>
                                <option value="Hyper√©cho√Øque" data-i18n="echogenicHyper">Hyper√©cho√Øque</option>
                                <option value="H√©t√©rog√®ne" data-i18n="echogenicHetero">H√©t√©rog√®ne</option>
                                <option value="Autre" data-i18n="echogenicOther">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label data-i18n="anatomicalRisks">Risques anatomiques</label>
                            <textarea name="anatomicalRisks"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="vascularity">Vascularit√© (Doppler)</label>
                            <input type="text" name="vascularity">
                        </div>
                    </div>
                </div>

                <!-- D√âTAILS DE LA PROC√âDURE EUS -->
                <div class="form-section">
                    <h3>‚öïÔ∏è D√©tails de la Proc√©dure EUS</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="endoscopeType">Type d'endoscope</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="endoscopeType" value="Radial" id="endo-r">
                                    <label for="endo-r">Radial</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="endoscopeType" value="Linear" id="endo-l">
                                    <label for="endo-l">Linear</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="procedureType">Proc√©dure</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="procedureType" value="FNA" id="proc-fna">
                                    <label for="proc-fna">FNA</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="procedureType" value="FNB" id="proc-fnb">
                                    <label for="proc-fnb">FNB</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="approach">Approche</label>
                            <select name="approach">
                                <option value="" data-i18n="select">S√©lectionner...</option>
                                <option value="Esophageal" data-i18n="appEsophageal">≈ísophagienne</option>
                                <option value="Gastric" data-i18n="appGastric">Gastrique</option>
                                <option value="Duodenal" data-i18n="appDuodenal">Duod√©nale</option>
                                <option value="Rectal" data-i18n="appRectal">Rectale</option>
                                <option value="Other" data-i18n="appOther">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label data-i18n="station">Station</label>
                            <input type="text" name="station">
                        </div>
                        <div class="form-group">
                            <label data-i18n="singleMultiple">Unique ou multiple</label>
                            <input type="text" name="singleMultiple">
                        </div>
                        <div class="form-group">
                            <label data-i18n="needleType">Type d'aiguille</label>
                            <select name="needleType">
                                <option value="" data-i18n="select">S√©lectionner...</option>
                                <option value="Boston acquire">Boston acquire</option>
                                <option value="Boston expect">Boston expect</option>
                                <option value="EZ Shot 3">EZ Shot 3</option>
                                <option value="Wilson Procore">Wilson Procore</option>
                                <option value="Microtech">Microtech</option>
                                <option value="Needle knife">Needle knife</option>
                                <option value="Cook Echo Tip">Cook Echo Tip</option>
                                <option value="Cook Access">Cook Access</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label data-i18n="needleGauge">Calibre d'aiguille</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="needleGauge" value="25G" id="ng-25">
                                    <label for="ng-25">25G</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="needleGauge" value="22G" id="ng-22">
                                    <label for="ng-22">22G</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="needleGauge" value="19G" id="ng-19">
                                    <label for="ng-19">19G</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="numberOfPasses">Nombre de passages</label>
                            <input type="number" name="numberOfPasses" min="0">
                        </div>
                        <div class="form-group">
                            <label data-i18n="mose">MOSE</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="mose" value="Oui" id="mose-y">
                                    <label for="mose-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="mose" value="Non" id="mose-n">
                                    <label for="mose-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="rose">ROSE</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="rose" value="Oui" id="rose-y">
                                    <label for="rose-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="rose" value="Non" id="rose-n">
                                    <label for="rose-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="sedation">S√©dation/Anesth√©sie</label>
                            <input type="text" name="sedation">
                        </div>
                        <div class="form-group">
                            <label data-i18n="antibioticProphylaxis">Prophylaxie antibiotique</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="antibioticProphylaxis" value="Oui" id="abx-y">
                                    <label for="abx-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="antibioticProphylaxis" value="Non" id="abx-n">
                                    <label for="abx-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="antibioticType">Type d'antibiotique</label>
                            <input type="text" name="antibioticType">
                        </div>
                        <div class="form-group">
                            <label data-i18n="technicalDifficulty">Difficult√© technique</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="technicalDifficulty" value="Oui" id="diff-y">
                                    <label for="diff-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="technicalDifficulty" value="Non" id="diff-n">
                                    <label for="diff-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="technicalDifficultyDetails">Pr√©ciser la difficult√©</label>
                            <input type="text" name="technicalDifficultyDetails">
                        </div>
                    </div>
                </div>

                <!-- DIAGNOSTIC ET R√âSULTAT -->
                <div class="form-section">
                    <h3>üî¨ Diagnostic et R√©sultat</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="cytologyHistology">R√©sultat cytologie/histologie</label>
                            <textarea name="cytologyHistology"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="sampleAdequacy">Ad√©quation de l'√©chantillon</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="sampleAdequacy" value="Adequate" id="samp-a">
                                    <label for="samp-a" data-i18n="adequate">Ad√©quat</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="sampleAdequacy" value="Poor" id="samp-p">
                                    <label for="samp-p" data-i18n="poor">Pauvre</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="sampleAdequacy" value="Non-contributory" id="samp-n">
                                    <label for="samp-n" data-i18n="nonContributory">Non contributif</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="sampleType">Type d'√©chantillon</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="sampleType" value="Cytology" id="type-c">
                                    <label for="type-c" data-i18n="sampCytology">Cytologie</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="sampleType" value="Histology" id="type-h">
                                    <label for="type-h" data-i18n="sampHistology">Histologie (FNB)</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="diagnosisObtained">Diagnostic obtenu</label>
                            <textarea name="diagnosisObtained"></textarea>
                        </div>
                        <div class="form-group">
                            <label data-i18n="additionalStudies">√âtudes suppl√©mentaires requises</label>
                            <input type="text" name="additionalStudies" data-i18n="phAdditionalStudies" placeholder="Immunohistochimie, Biologie mol√©culaire, Autre">
                        </div>
                        <div class="form-group">
                            <label data-i18n="clinicalImpact">Impact clinique</label>
                            <input type="text" name="clinicalImpact" data-i18n="phClinicalImpact" placeholder="D√©cision th√©rapeutique, Chirurgie √©vit√©e, Staging, etc.">
                        </div>
                        <div class="form-group">
                            <label data-i18n="multidisciplinary">Discut√© en RCP</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="multidisciplinary" value="Oui" id="rcp-y">
                                    <label for="rcp-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="multidisciplinary" value="Non" id="rcp-n">
                                    <label for="rcp-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- COMPLICATIONS -->
                <div class="form-section">
                    <h3>‚ö†Ô∏è Complications</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="immediateComplications">Complications imm√©diates</label>
                            <input type="text" name="immediateComplications" data-i18n="phImmediateComplications" placeholder="Aucune, Saignement, Perforation, Douleur, Autre">
                        </div>
                        <div class="form-group">
                            <label data-i18n="delayedComplications">Complications retard√©es</label>
                            <textarea name="delayedComplications"></textarea>
                        </div>
                    </div>
                </div>

                <!-- SUIVI -->
                <div class="form-section">
                    <h3>üìÖ Suivi</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label data-i18n="concordance">Concordance avec diagnostic chirurgical/clinique final</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="concordance" value="Oui" id="conc-y">
                                    <label for="conc-y" data-i18n="yes">Oui</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="concordance" value="Non" id="conc-n">
                                    <label for="conc-n" data-i18n="no">Non</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="recurrence">R√©cidive/Progression</label>
                            <textarea name="recurrence"></textarea>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary" data-i18n="savePatient">üíæ Enregistrer le Patient</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()" data-i18n="reset">üîÑ R√©initialiser</button>
                </div>
            </form>
        </div>

        <!-- TAB 2: LISTE DES PATIENTS -->
        <div id="patients-tab" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">üë• Liste des Patients Enregistr√©s</h2>
            <div class="button-group">
                <button class="btn btn-primary" onclick="exportData()" data-i18n="exportData">üì• Exporter les donn√©es (JSON)</button>
                <button class="btn btn-secondary" onclick="importData()" data-i18n="importData">üì§ Importer des donn√©es</button>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleImport(event)">
            </div>
            <div id="patient-list" class="patient-list"></div>
        </div>

        <!-- TAB 3: STATISTIQUES -->
        <div id="stats-tab" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 30px; text-align: center;">üìä Statistiques et Analyses</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="total-patients">0</h3>
                    <p>Patients Total</p>
                </div>
                <div class="stat-card">
                    <h3 id="technical-success">0%</h3>
                    <p>Taux de Succ√®s Technique</p>
                </div>
                <div class="stat-card">
                    <h3 id="adequate-sample">0%</h3>
                    <p>Taux d'√âchantillon Ad√©quat</p>
                </div>
                <div class="stat-card">
                    <h3 id="complication-rate">0%</h3>
                    <p>Taux de Complications</p>
                </div>
            </div>

            <div class="chart-container">
                <h3>R√©partition par Genre</h3>
                <div class="chart-wrapper">
                    <canvas id="gender-chart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>R√©partition par √Çge</h3>
                <div class="chart-wrapper">
                    <canvas id="age-chart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>Indications Principales pour EUS</h3>
                <div class="chart-wrapper">
                    <canvas id="indication-chart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>Type de Proc√©dure (FNA vs FNB)</h3>
                <div class="chart-wrapper">
                    <canvas id="procedure-chart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>Calibre d'Aiguille Utilis√©</h3>
                <div class="chart-wrapper">
                    <canvas id="needle-gauge-chart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>Ad√©quation de l'√âchantillon</h3>
                <div class="chart-wrapper">
                    <canvas id="sample-adequacy-chart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>Distribution de la Taille des L√©sions (mm)</h3>
                <div class="chart-wrapper">
                    <canvas id="lesion-size-chart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>Complications Imm√©diates</h3>
                <div class="chart-wrapper">
                    <canvas id="complications-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Langue par d√©faut
        let currentLanguage = localStorage.getItem('eusLanguage') || 'en';

        // Traductions
        const translations = {
            fr: {
                headerTitle: 'üìä EUS Data Collection & Statistics',
                headerSubtitle: 'Syst√®me de collecte et d\'analyse des donn√©es EUS',
                tabForm: '‚ûï Nouveau Patient',
                tabPatients: 'üë• Liste des Patients',
                tabStats: 'üìà Statistiques',
                successMessage: '‚úÖ Patient enregistr√© avec succ√®s !',
                
                // Sections du formulaire
                sectionIdentity: 'üÜî Identit√© du Patient',
                sectionIndication: 'üéØ Indication Principale pour EUS',
                sectionHistory: 'üìã Ant√©c√©dents M√©dicaux',
                sectionGeneralSigns: 'üå°Ô∏è Signes G√©n√©raux',
                sectionFunctionalSigns: 'üîç Signes Fonctionnels',
                sectionInvestigations: 'üî¨ Investigations Avant EUS',
                sectionEUSFindings: 'üìç R√©sultats EUS',
                sectionProcedure: '‚öïÔ∏è D√©tails de la Proc√©dure EUS',
                sectionDiagnosis: 'üî¨ Diagnostic et R√©sultat',
                sectionComplications: '‚ö†Ô∏è Complications',
                sectionFollowUp: 'üìÖ Suivi',
                
                // Labels
                fullName: 'Nom complet',
                medicalRecordNumber: 'Num√©ro de dossier m√©dical',
                age: '√Çge',
                gender: 'Genre',
                female: 'Femme',
                male: 'Homme',
                residency: 'R√©sidence',
                rural: 'Rural',
                urban: 'Urban',
                dateAdmission: 'Date d\'admission',
                dateDischarge: 'Date de sortie',
                referringDepartment: 'D√©partement r√©f√©rent',
                deptOncology: 'Oncologie',
                deptPulmonology: 'Pneumologie',
                deptEndocrinology: 'Endocrinologie',
                deptGastroenterology: 'Gastroent√©rologie',
                deptOther: 'Autre',
                select: 'S√©lectionner...',
                
                // Indications
                mediastinalMass: 'Masse m√©diastinale',
                lymphadenopathy: 'Lymphad√©nopathie',
                thyroidNodule: 'Nodule thyro√Ødien',
                adrenalLesion: 'L√©sion surr√©nalienne',
                otherSpecify: 'Autre (pr√©ciser)',
                
                // Ant√©c√©dents
                historyMalignancy: 'Ant√©c√©dents de malignit√©',
                thyroidDisorders: 'Troubles thyro√Ødiens',
                cardiopulmonary: 'Maladies cardiopulmonaires',
                historyInfections: 'Ant√©c√©dents d\'infections',
                otherComorbidities: 'Autres comorbidit√©s',
                surgicalHistory: 'Ant√©c√©dents chirurgicaux',
                addictiveSubstances: 'Substances addictives',
                allergies: 'Allergies',
                familyMalignancy: 'Ant√©c√©dents familiaux de malignit√©',
                hereditaryAffections: 'Affections h√©r√©ditaires',
                
                // Signes g√©n√©raux
                fever: 'Fi√®vre',
                yes: 'Oui',
                no: 'Non',
                temperature: 'Temp√©rature (¬∞C)',
                weightLoss: 'Perte de poids involontaire',
                weightLossAmount: 'Kg/temps',
                asthenia: 'Asth√©nie',
                anorexia: 'Anorexie',
                nightSweats: 'Sueurs nocturnes',
                pallor: 'P√¢leur',
                edema: '≈íd√®me',
                edemaCharacter: 'Caract√®re de l\'≈ìd√®me',
                jaundice: 'Ict√®re',
                alteredCondition: '√âtat g√©n√©ral alt√©r√©',

                // Signes Fonctionnels
                goitre: 'Goitre/nodule',
                dysphonia: 'Dysphonie',
                dysphagia: 'Dysphagie',
                neckPain: 'Douleur cervicale',
                compression: 'Sensation de compression',
                chronicCough: 'Toux chronique',
                hemoptysis: 'H√©moptysie',
                dyspnea: 'Dyspn√©e',
                chestPain: 'Douleur thoracique',
                hoarseness: 'Enrouement',

                // Investigations
                biology: 'Biologie',
                tumorMarkers: 'Marqueurs tumoraux',
                radiography: 'Radiographie',
                ultrasound: '√âchographie',
                ctScan: 'CT-Scan',
                mri: 'IRM',
                petScan: 'PET-Scan',
                ebus: 'EBUS',
                
                // Proc√©dure
                lesionLocation: 'Localisation de la l√©sion',
                lesionSize: 'Taille (mm)',
                echogenicPattern: 'Pattern √©chog√©nique',
                echogenicHypo: 'Hypo√©cho√Øque',
                echogenicHyper: 'Hyper√©cho√Øque',
                echogenicHetero: 'H√©t√©rog√®ne',
                echogenicOther: 'Autre',
                anatomicalRisks: 'Risques anatomiques',
                vascularity: 'Vascularit√© (Doppler)',
                endoscopeType: 'Type d\'endoscope',
                procedureType: 'Proc√©dure',

                approach: 'Approche',
                appEsophageal: '≈ísophagienne',
                appGastric: 'Gastrique',
                appDuodenal: 'Duod√©nale',
                appRectal: 'Rectale',
                appOther: 'Autre',
                station: 'Station',
                singleMultiple: 'Unique ou multiple',
                needleType: 'Type d\'aiguille',
                needleGauge: 'Calibre d\'aiguille',
                numberOfPasses: 'Nombre de passages',
                mose: 'MOSE',
                rose: 'ROSE',
                sedation: 'S√©dation/Anesth√©sie',
                antibioticProphylaxis: 'Prophylaxie antibiotique',
                antibioticType: 'Type d\'antibiotique',
                technicalDifficulty: 'Difficult√© technique',
                technicalDifficultyDetails: 'Pr√©ciser la difficult√©',
                
                // Diagnostic et R√©sultat
                cytologyHistology: 'R√©sultat cytologie/histologie',
                sampleAdequacy: 'Ad√©quation de l\'√©chantillon',
                adequate: 'Ad√©quat',
                poor: 'Pauvre',
                nonContributory: 'Non contributif',
                sampleType: 'Type d\'√©chantillon',
                sampCytology: 'Cytologie',
                sampHistology: 'Histologie (FNB)',
                diagnosisObtained: 'Diagnostic obtenu',
                additionalStudies: '√âtudes suppl√©mentaires requises',
                clinicalImpact: 'Impact clinique',
                multidisciplinary: 'Discut√© en RCP',

                // Complications
                immediateComplications: 'Complications imm√©diates',
                delayedComplications: 'Complications retard√©es',

                // Suivi
                concordance: 'Concordance avec diagnostic chirurgical/clinique final',
                recurrence: 'R√©cidive/Progression',
                
                // Boutons
                savePatient: 'üíæ Enregistrer le Patient',
                reset: 'üîÑ R√©initialiser',
                exportData: 'üì• Exporter les donn√©es (JSON)',
                importData: 'üì§ Importer des donn√©es',
                edit: '‚úèÔ∏è Modifier',
                delete: 'üóëÔ∏è Supprimer',
                
                // Liste patients
                patientsListTitle: 'üë• Liste des Patients Enregistr√©s',
                noPatients: 'Aucun patient enregistr√© pour le moment.',
                file: 'Dossier',
                lesion: 'L√©sion',
                size: 'Taille',
                
                // Stats
                statsTitle: 'üìä Statistiques et Analyses',
                totalPatients: 'Patients Total',
                technicalSuccess: 'Taux de Succ√®s Technique',
                adequateSampleRate: 'Taux d\'√âchantillon Ad√©quat',
                complicationRate: 'Taux de Complications',
                
                // Graphiques
                chartGender: 'R√©partition par Genre',
                chartAge: 'R√©partition par √Çge',
                chartIndication: 'Indications Principales pour EUS',
                chartProcedure: 'Type de Proc√©dure (FNA vs FNB)',
                chartNeedle: 'Calibre d\'Aiguille Utilis√©',
                chartAdequacy: 'Ad√©quation de l\'√âchantillon',
                chartLesionSize: 'Distribution de la Taille des L√©sions (mm)',
                chartComplications: 'Complications Imm√©diates',
                
                deleteConfirm: '√ätes-vous s√ªr de vouloir supprimer ce patient ?',
                importConfirm: 'Importer {count} patients ? Cela remplacera les donn√©es existantes.',
                importSuccess: 'Donn√©es import√©es avec succ√®s !',
                importError: 'Erreur lors de l\'importation du fichier.',

                // Placeholders
                phAdditionalStudies: 'Immunohistochimie, Biologie mol√©culaire, Autre',
                phClinicalImpact: 'D√©cision th√©rapeutique, Chirurgie √©vit√©e, Staging, etc.',
                phImmediateComplications: 'Aucune, Saignement, Perforation, Douleur, Autre',

                // Chart Labels
                unspecified: 'Non sp√©cifi√©',
                numberOfPatients: 'Nombre de patients',
                numberOfCases: 'Nombre de cas',
                numberOfLesions: 'Nombre de l√©sions',
                compNone: 'Aucune',
                compBleeding: 'Saignement',
                compPerforation: 'Perforation',
                compPain: 'Douleur',
                compOther: 'Autre'
            },
            en: {
                headerTitle: 'üìä EUS Data Collection & Statistics',
                headerSubtitle: 'EUS Data Collection and Analysis System',
                tabForm: '‚ûï New Patient',
                tabPatients: 'üë• Patient List',
                tabStats: 'üìà Statistics',
                successMessage: '‚úÖ Patient successfully registered!',
                
                // Form sections
                sectionIdentity: 'üÜî Patient Identity',
                sectionIndication: 'üéØ Main Indication for EUS',
                sectionHistory: 'üìã Medical History',
                sectionGeneralSigns: 'üå°Ô∏è General Signs',
                sectionFunctionalSigns: 'üîç Functional Signs',
                sectionInvestigations: 'üî¨ Investigations Before EUS',
                sectionEUSFindings: 'üìç EUS Findings',
                sectionProcedure: '‚öïÔ∏è EUS Procedure Details',
                sectionDiagnosis: 'üî¨ Diagnosis & Outcome',
                sectionComplications: '‚ö†Ô∏è Complications',
                sectionFollowUp: 'üìÖ Follow-up',
                
                // Labels
                fullName: 'Full name',
                medicalRecordNumber: 'Medical record number',
                age: 'Age',
                gender: 'Gender',
                female: 'Female',
                male: 'Male',
                residency: 'Residency',
                rural: 'Rural',
                urban: 'Urban',
                dateAdmission: 'Date of admission',
                dateDischarge: 'Date of discharge',
                referringDepartment: 'Referring department',
                deptOncology: 'Oncology',
                deptPulmonology: 'Pulmonology',
                deptEndocrinology: 'Endocrinology',
                deptGastroenterology: 'Gastroenterology',
                deptOther: 'Other',
                select: 'Select...',
                
                // Indications
                mediastinalMass: 'Mediastinal mass',
                lymphadenopathy: 'Lymphadenopathy',
                thyroidNodule: 'Thyroid nodule',
                adrenalLesion: 'Adrenal lesion',
                otherSpecify: 'Other (specify)',
                
                // History
                historyMalignancy: 'History of malignancy',
                thyroidDisorders: 'Thyroid disorders',
                cardiopulmonary: 'Cardiopulmonary diseases',
                historyInfections: 'History of infections',
                otherComorbidities: 'Other comorbidities',
                surgicalHistory: 'Surgical history',
                addictiveSubstances: 'Addictive substances',
                allergies: 'Allergies',
                familyMalignancy: 'Family history of malignancy',
                hereditaryAffections: 'Hereditary affections',
                
                // General signs
                fever: 'Fever',
                yes: 'Yes',
                no: 'No',
                temperature: 'Temperature (¬∞C)',
                weightLoss: 'Weight loss (involuntary)',
                weightLossAmount: 'Kg/time',
                asthenia: 'Asthenia',
                anorexia: 'Anorexia',
                nightSweats: 'Night sweats',
                pallor: 'Pallor',
                edema: 'Edema',
                edemaCharacter: 'Edema character',
                jaundice: 'Jaundice',
                alteredCondition: 'Altered general condition',

                // Functional signs
                goitre: 'Goiter/nodule',
                dysphonia: 'Dysphonia',
                dysphagia: 'Dysphagia',
                neckPain: 'Neck pain',
                compression: 'Compression sensation',
                chronicCough: 'Chronic cough',
                hemoptysis: 'Hemoptysis',
                dyspnea: 'Dyspnea',
                chestPain: 'Chest pain',
                hoarseness: 'Hoarseness',

                // Investigations
                biology: 'Biology',
                tumorMarkers: 'Tumor markers',
                radiography: 'Radiography',
                ultrasound: 'Ultrasound',
                ctScan: 'CT-Scan',
                mri: 'MRI',
                petScan: 'PET-Scan',
                ebus: 'EBUS',
                
                // Procedure
                lesionLocation: 'Lesion location',
                lesionSize: 'Size (mm)',
                echogenicPattern: 'Echogenic pattern',
                echogenicHypo: 'Hypoechoic',
                echogenicHyper: 'Hyperechoic',
                echogenicHetero: 'Heterogeneous',
                echogenicOther: 'Other',
                anatomicalRisks: 'Anatomical risks',
                vascularity: 'Vascularity (Doppler)',
                endoscopeType: 'Endoscope type',
                procedureType: 'Procedure',

                approach: 'Approach',
                appEsophageal: 'Esophageal',
                appGastric: 'Gastric',
                appDuodenal: 'Duod√©nale',
                appRectal: 'Rectale',
                appOther: 'Other',
                station: 'Station',
                singleMultiple: 'Single or multiple',
                needleType: 'Needle type',
                needleGauge: 'Needle gauge',
                numberOfPasses: 'Number of passes',
                mose: 'MOSE',
                rose: 'ROSE',
                sedation: 'Sedation/Anesthesia',
                antibioticProphylaxis: 'Antibiotic prophylaxis',
                antibioticType: 'Antibiotic type',
                technicalDifficulty: 'Technical difficulty',
                technicalDifficultyDetails: 'Specify difficulty',
                
                // Diagnosis
                cytologyHistology: 'Cytology/histology result',
                sampleAdequacy: 'Sample adequacy',
                adequate: 'Adequate',
                poor: 'Poor',
                nonContributory: 'Non-contributory',
                sampleType: 'Sample type',
                sampCytology: 'Cytology',
                sampHistology: 'Histology (FNB)',
                diagnosisObtained: 'Diagnosis obtained',
                additionalStudies: 'Additional studies required',
                clinicalImpact: 'Clinical impact',
                multidisciplinary: 'Discussed in MDT',

                // Complications
                immediateComplications: 'Immediate complications',
                delayedComplications: 'Delayed complications',

                // Follow up
                concordance: 'Concordance with final surgical/clinical diagnosis',
                recurrence: 'Recurrence/Progression',
                
                // Buttons
                savePatient: 'üíæ Save Patient',
                reset: 'üîÑ Reset',
                exportData: 'üì• Export Data (JSON)',
                importData: 'üì§ Import Data',
                edit: '‚úèÔ∏è Edit',
                delete: 'üóëÔ∏è Delete',
                
                // Patient list
                patientsListTitle: 'üë• Registered Patients List',
                noPatients: 'No patients registered yet.',
                file: 'File',
                lesion: 'Lesion',
                size: 'Size',
                
                // Stats
                statsTitle: 'üìä Statistics and Analysis',
                totalPatients: 'Total Patients',
                technicalSuccess: 'Technical Success Rate',
                adequateSampleRate: 'Adequate Sample Rate',
                complicationRate: 'Complication Rate',
                
                // Charts
                chartGender: 'Gender Distribution',
                chartAge: 'Age Distribution',
                chartIndication: 'Main Indications for EUS',
                chartProcedure: 'Procedure Type (FNA vs FNB)',
                chartNeedle: 'Needle Gauge Used',
                chartAdequacy: 'Sample Adequacy',
                chartLesionSize: 'Lesion Size Distribution (mm)',
                chartComplications: 'Immediate Complications',
                
                deleteConfirm: 'Are you sure you want to delete this patient?',
                importConfirm: 'Import {count} patients? This will replace existing data.',
                importSuccess: 'Data imported successfully!',
                importError: 'Error importing file.',

                // Placeholders
                phAdditionalStudies: 'Immunohistochemistry, Molecular biology, Other',
                phClinicalImpact: 'Therapeutic decision, Surgery avoided, Staging, etc.',
                phImmediateComplications: 'None, Bleeding, Perforation, Pain, Other',

                // Chart Labels
                unspecified: 'Unspecified',
                numberOfPatients: 'Number of patients',
                numberOfCases: 'Number of cases',
                numberOfLesions: 'Number of lesions',
                compNone: 'None',
                compBleeding: 'Bleeding',
                compPerforation: 'Perforation',
                compPain: 'Pain',
                compOther: 'Other'
            }
        };

        // Fonction pour changer la langue
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('eusLanguage', lang);
            
            // Mettre √† jour l'indicateur actif
            document.getElementById('lang-fr').classList.toggle('active', lang === 'fr');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            
            // Appliquer les traductions
            applyTranslations();
            
            // Mettre √† jour les graphiques si on est sur l'onglet stats
            if (document.getElementById('stats-tab').classList.contains('active')) {
                updateStatistics();
            }
        }

        // Fonction pour appliquer les traductions
        function applyTranslations() {
            const t = translations[currentLanguage];
            
            // Header
            document.getElementById('header-title').textContent = t.headerTitle;
            document.getElementById('header-subtitle').textContent = t.headerSubtitle;
            
            // Onglets
            document.querySelectorAll('.tab')[0].innerHTML = t.tabForm;
            document.querySelectorAll('.tab')[1].innerHTML = t.tabPatients;
            document.querySelectorAll('.tab')[2].innerHTML = t.tabStats;
            
            // Messages
            document.getElementById('success-message').innerHTML = t.successMessage;
            
            // Titres de sections
            const sections = document.querySelectorAll('.form-section h3');
            if (sections.length > 0) {
                sections[0].textContent = t.sectionIdentity;
                sections[1].textContent = t.sectionIndication;
                sections[2].textContent = t.sectionHistory;
                sections[3].textContent = t.sectionGeneralSigns;
                sections[4].textContent = t.sectionFunctionalSigns;
                sections[5].textContent = t.sectionInvestigations;
                sections[6].textContent = t.sectionEUSFindings;
                sections[7].textContent = t.sectionProcedure;
                sections[8].textContent = t.sectionDiagnosis;
                sections[9].textContent = t.sectionComplications;
                sections[10].textContent = t.sectionFollowUp;
            }
            
            // Mettre √† jour tous les √©l√©ments avec data-i18n
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    // Si c'est un input ou textarea, on met √† jour le placeholder
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = t[key];
                    } 
                    // Si c'est un label de form-group (avec *), on g√®re l'ast√©risque
                    else {
                        const parentIsFormGroup = el.closest('.form-group') && el.tagName === 'LABEL' && !el.hasAttribute('for');
                        if (parentIsFormGroup && el.textContent.includes('*')) {
                            el.textContent = t[key] + ' *';
                        } else {
                            el.textContent = t[key];
                        }
                    }
                }
            });
            
            // Stats
            const statsTitle = document.querySelector('#stats-tab h2');
            if (statsTitle) statsTitle.textContent = t.statsTitle;
            
            const statCards = document.querySelectorAll('.stat-card p');
            if (statCards.length >= 4) {
                statCards[0].textContent = t.totalPatients;
                statCards[1].textContent = t.technicalSuccess;
                statCards[2].textContent = t.adequateSampleRate;
                statCards[3].textContent = t.complicationRate;
            }
            
            // Titres des graphiques
            const chartTitles = document.querySelectorAll('.chart-container h3');
            if (chartTitles.length >= 8) {
                chartTitles[0].textContent = t.chartGender;
                chartTitles[1].textContent = t.chartAge;
                chartTitles[2].textContent = t.chartIndication;
                chartTitles[3].textContent = t.chartProcedure;
                chartTitles[4].textContent = t.chartNeedle;
                chartTitles[5].textContent = t.chartAdequacy;
                chartTitles[6].textContent = t.chartLesionSize;
                chartTitles[7].textContent = t.chartComplications;
            }
            
            // Liste patients
            const patientsTitle = document.querySelector('#patients-tab h2');
            if (patientsTitle) patientsTitle.textContent = t.patientsListTitle;
            
            // Mettre √† jour la liste des patients
            updatePatientList();
        }

        // Stockage des donn√©es
        let patients = JSON.parse(localStorage.getItem('eusPatients') || '[]');
        let editingIndex = -1;

        // Charger les patients au d√©marrage
        window.addEventListener('DOMContentLoaded', function() {
            applyTranslations();
            updatePatientList();
            updateStatistics();
        });

        // Gestion des onglets
        function switchTab(tabName) {
            // Masquer tous les contenus
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // D√©sactiver tous les boutons d'onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activer l'onglet s√©lectionn√©
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            // Mettre √† jour les statistiques si on va sur l'onglet stats
            if (tabName === 'stats') {
                updateStatistics();
            }
            
            // Mettre √† jour la liste des patients si on va sur l'onglet patients
            if (tabName === 'patients') {
                updatePatientList();
            }
        }

        // Soumission du formulaire
        document.getElementById('patient-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const patient = {};
            
            // Convertir FormData en objet
            for (let [key, value] of formData.entries()) {
                patient[key] = value;
            }
            
            // Ajouter un timestamp
            patient.timestamp = new Date().toISOString();
            
            // Ajouter ou modifier le patient
            if (editingIndex >= 0) {
                patients[editingIndex] = patient;
                editingIndex = -1;
            } else {
                patients.push(patient);
            }
            
            // Sauvegarder dans localStorage
            localStorage.setItem('eusPatients', JSON.stringify(patients));
            
            // Afficher le message de succ√®s
            const successMsg = document.getElementById('success-message');
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
            
            // R√©initialiser le formulaire
            this.reset();
            
            // Mettre √† jour la liste
            updatePatientList();
        });

        // R√©initialiser le formulaire
        function resetForm() {
            document.getElementById('patient-form').reset();
            editingIndex = -1;
        }

        // Mettre √† jour la liste des patients
        function updatePatientList() {
            const listContainer = document.getElementById('patient-list');
            const t = translations[currentLanguage];
            
            if (patients.length === 0) {
                listContainer.innerHTML = `<p style="text-align: center; color: #6c757d; padding: 40px;">${t.noPatients}</p>`;
                return;
            }
            
            listContainer.innerHTML = patients.map((patient, index) => `
                <div class="patient-card">
                    <div class="patient-info">
                        <h4>${patient.fullName || 'N/A'}</h4>
                        <p>${t.file}: ${patient.medicalRecordNumber || 'N/A'} | ${t.age}: ${patient.age || 'N/A'} | ${t.gender}: ${patient.gender || 'N/A'}</p>
                        <p>${t.lesion}: ${patient.lesionLocation || 'N/A'} | ${t.size}: ${patient.lesionSize || 'N/A'} mm</p>
                    </div>
                    <div class="patient-actions">
                        <button class="btn btn-secondary" onclick="editPatient(${index})">${t.edit}</button>
                        <button class="btn btn-danger" onclick="deletePatient(${index})">${t.delete}</button>
                    </div>
                </div>
            `).join('');
        }

        // √âditer un patient
        function editPatient(index) {
            const patient = patients[index];
            editingIndex = index;
            
            // Remplir le formulaire
            const form = document.getElementById('patient-form');
            Object.keys(patient).forEach(key => {
                const input = form.elements[key];
                if (input) {
                    if (input.type === 'radio') {
                        const radioInput = form.querySelector(`input[name="${key}"][value="${patient[key]}"]`);
                        if (radioInput) radioInput.checked = true;
                    } else if (input.type === 'checkbox') {
                        input.checked = patient[key];
                    } else {
                        input.value = patient[key];
                    }
                }
            });
            
            // Aller √† l'onglet formulaire
            switchTab('form');
            document.querySelector('.tab').click();
            
            // Scroll vers le haut
            window.scrollTo(0, 0);
        }

        // Supprimer un patient
        function deletePatient(index) {
            const t = translations[currentLanguage];
            if (confirm(t.deleteConfirm)) {
                patients.splice(index, 1);
                localStorage.setItem('eusPatients', JSON.stringify(patients));
                updatePatientList();
                updateStatistics();
            }
        }

        // Exporter les donn√©es
        function exportData() {
            const dataStr = JSON.stringify(patients, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `eus_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Importer des donn√©es
        function importData() {
            document.getElementById('import-file').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            const t = translations[currentLanguage];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (confirm(t.importConfirm.replace('{count}', importedData.length))) {
                            patients = importedData;
                            localStorage.setItem('eusPatients', JSON.stringify(patients));
                            updatePatientList();
                            updateStatistics();
                            alert(t.importSuccess);
                        }
                    } catch (error) {
                        alert(t.importError);
                    }
                };
                reader.readAsText(file);
            }
        }

        // Variables pour les graphiques
        let charts = {};

        // Mettre √† jour les statistiques
        function updateStatistics() {
            if (patients.length === 0) {
                document.getElementById('total-patients').textContent = '0';
                document.getElementById('technical-success').textContent = '0%';
                document.getElementById('adequate-sample').textContent = '0%';
                document.getElementById('complication-rate').textContent = '0%';
                
                // D√©truire tous les graphiques existants
                Object.values(charts).forEach(chart => chart.destroy());
                charts = {};
                return;
            }
            
            // Total des patients
            document.getElementById('total-patients').textContent = patients.length;
            
            // Taux de succ√®s technique (bas√© sur la difficult√© technique)
            const technicalSuccess = patients.filter(p => p.technicalDifficulty !== 'Oui').length;
            const successRate = ((technicalSuccess / patients.length) * 100).toFixed(1);
            document.getElementById('technical-success').textContent = successRate + '%';
            
            // Taux d'√©chantillon ad√©quat
            const adequateSamples = patients.filter(p => p.sampleAdequacy === 'Adequate').length;
            const adequateRate = ((adequateSamples / patients.length) * 100).toFixed(1);
            document.getElementById('adequate-sample').textContent = adequateRate + '%';
            
            // Taux de complications
            const complications = patients.filter(p => 
                p.immediateComplications && 
                p.immediateComplications !== '' && 
                p.immediateComplications.toLowerCase() !== 'aucune' &&
                p.immediateComplications.toLowerCase() !== 'none'
            ).length;
            const complicationRate = ((complications / patients.length) * 100).toFixed(1);
            document.getElementById('complication-rate').textContent = complicationRate + '%';
            
            // Graphiques
            createGenderChart();
            createAgeChart();
            createIndicationChart();
            createProcedureChart();
            createNeedleGaugeChart();
            createSampleAdequacyChart();
            createLesionSizeChart();
            createComplicationsChart();
        }

        // Graphique Genre
        function createGenderChart() {
            const ctx = document.getElementById('gender-chart');
            if (charts.gender) charts.gender.destroy();
            
            const t = translations[currentLanguage];
            const genderCounts = patients.reduce((acc, p) => {
                let genderLabel = p.gender || t.unspecified;
                if (genderLabel === 'Homme') genderLabel = t.male;
                if (genderLabel === 'Femme') genderLabel = t.female;
                if (genderLabel === 'Male') genderLabel = t.male;
                if (genderLabel === 'Female') genderLabel = t.female;
                
                acc[genderLabel] = (acc[genderLabel] || 0) + 1;
                return acc;
            }, {});
            
            charts.gender = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(genderCounts),
                    datasets: [{
                        data: Object.values(genderCounts),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Graphique √Çge
        function createAgeChart() {
            const ctx = document.getElementById('age-chart');
            if (charts.age) charts.age.destroy();
            
            const t = translations[currentLanguage];
            
            const ageRanges = {'0-20': 0, '21-40': 0, '41-60': 0, '61-80': 0, '80+': 0};
            patients.forEach(p => {
                const age = parseInt(p.age);
                if (age <= 20) ageRanges['0-20']++;
                else if (age <= 40) ageRanges['21-40']++;
                else if (age <= 60) ageRanges['41-60']++;
                else if (age <= 80) ageRanges['61-80']++;
                else ageRanges['80+']++;
            });
            
            charts.age = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(ageRanges),
                    datasets: [{
                        label: t.numberOfPatients,
                        data: Object.values(ageRanges),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Graphique Indications
        // Graphique Indications
        function createIndicationChart() {
            const ctx = document.getElementById('indication-chart');
            if (charts.indication) charts.indication.destroy();
            
            const t = translations[currentLanguage];
            const indications = {};
            indications[t.mediastinalMass] = 0;
            indications[t.lymphadenopathy] = 0;
            indications[t.thyroidNodule] = 0;
            indications[t.adrenalLesion] = 0;
            indications[t.compOther] = 0;
            
            patients.forEach(p => {
                if (p.indication_mediastinalMass) indications[t.mediastinalMass]++;
                if (p.indication_lymphadenopathy) indications[t.lymphadenopathy]++;
                if (p.indication_thyroidNodule) indications[t.thyroidNodule]++;
                if (p.indication_adrenalLesion) indications[t.adrenalLesion]++;
                if (p.indication_other) indications[t.compOther]++;
            });
            
            charts.indication = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(indications),
                    datasets: [{
                        label: t.numberOfCases,
                        data: Object.values(indications),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Graphique Proc√©dure
        function createProcedureChart() {
            const ctx = document.getElementById('procedure-chart');
            if (charts.procedure) charts.procedure.destroy();
            
            const t = translations[currentLanguage];
            const procedureCounts = patients.reduce((acc, p) => {
                acc[p.procedureType || t.unspecified] = (acc[p.procedureType || t.unspecified] || 0) + 1;
                return acc;
            }, {});
            
            charts.procedure = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(procedureCounts),
                    datasets: [{
                        data: Object.values(procedureCounts),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Graphique Calibre d'aiguille
        function createNeedleGaugeChart() {
            const ctx = document.getElementById('needle-gauge-chart');
            if (charts.needleGauge) charts.needleGauge.destroy();
            
            const t = translations[currentLanguage];
            const gaugeCounts = patients.reduce((acc, p) => {
                acc[p.needleGauge || t.unspecified] = (acc[p.needleGauge || t.unspecified] || 0) + 1;
                return acc;
            }, {});
            
            charts.needleGauge = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(gaugeCounts),
                    datasets: [{
                        data: Object.values(gaugeCounts),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Graphique Ad√©quation de l'√©chantillon
        function createSampleAdequacyChart() {
            const ctx = document.getElementById('sample-adequacy-chart');
            if (charts.sampleAdequacy) charts.sampleAdequacy.destroy();
            
            const t = translations[currentLanguage];
            const adequacyCounts = patients.reduce((acc, p) => {
                let label = p.sampleAdequacy || t.unspecified;
                if (label === 'Adequate') label = t.adequate;
                if (label === 'Poor') label = t.poor;
                if (label === 'Non-contributory') label = t.nonContributory;
                if (label === 'Ad√©quat') label = t.adequate;
                if (label === 'Pauvre') label = t.poor;
                if (label === 'Non contributif') label = t.nonContributory;

                acc[label] = (acc[label] || 0) + 1;
                return acc;
            }, {});
            
            charts.sampleAdequacy = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(adequacyCounts),
                    datasets: [{
                        label: t.numberOfCases,
                        data: Object.values(adequacyCounts),
                        backgroundColor: ['#43e97b', '#f093fb', '#fa709a']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Graphique Taille des l√©sions
        function createLesionSizeChart() {
            const ctx = document.getElementById('lesion-size-chart');
            if (charts.lesionSize) charts.lesionSize.destroy();
            
            const sizes = patients.map(p => parseFloat(p.lesionSize)).filter(s => !isNaN(s));
            
            const sizeRanges = {'0-10': 0, '11-20': 0, '21-30': 0, '31-40': 0, '40+': 0};
            sizes.forEach(size => {
                if (size <= 10) sizeRanges['0-10']++;
                else if (size <= 20) sizeRanges['11-20']++;
                else if (size <= 30) sizeRanges['21-30']++;
                else if (size <= 40) sizeRanges['31-40']++;
                else sizeRanges['40+']++;
            });
            
            const t = translations[currentLanguage];
            
            charts.lesionSize = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(sizeRanges),
                    datasets: [{
                        label: t.numberOfLesions,
                        data: Object.values(sizeRanges),
                        backgroundColor: '#764ba2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: t.lesionSize
                            }
                        }
                    }
                }
            });
        }

        // Graphique Complications
        function createComplicationsChart() {
            const ctx = document.getElementById('complications-chart');
            if (charts.complications) charts.complications.destroy();
            
            const t = translations[currentLanguage];
            const complicationTypes = {};
            complicationTypes[t.compNone] = 0;
            complicationTypes[t.compBleeding] = 0;
            complicationTypes[t.compPerforation] = 0;
            complicationTypes[t.compPain] = 0;
            complicationTypes[t.compOther] = 0;
            
            patients.forEach(p => {
                const comp = p.immediateComplications || '';
                if (comp.toLowerCase().includes('aucune') || comp.toLowerCase().includes('none') || comp === '') {
                    complicationTypes[t.compNone]++;
                } else if (comp.toLowerCase().includes('saignement') || comp.toLowerCase().includes('bleeding')) {
                    complicationTypes[t.compBleeding]++;
                } else if (comp.toLowerCase().includes('perforation')) {
                    complicationTypes[t.compPerforation]++;
                } else if (comp.toLowerCase().includes('douleur') || comp.toLowerCase().includes('pain')) {
                    complicationTypes[t.compPain]++;
                } else {
                    complicationTypes[t.compOther]++;
                }
            });
            
            charts.complications = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(complicationTypes),
                    datasets: [{
                        data: Object.values(complicationTypes),
                        backgroundColor: ['#43e97b', '#fa709a', '#fee140', '#30cfd0', '#a8edea']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
